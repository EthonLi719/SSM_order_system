<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>å•†å“APIè°ƒè¯•</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; background: #f9f9f9; }
        .result { background: #f0f0f0; padding: 10px; margin: 10px 0; white-space: pre-wrap; font-family: monospace; }
        .error { background: #ffe6e6; padding: 10px; margin: 10px 0; color: red; }
        button { padding: 10px 15px; margin: 5px; background: #007bff; color: white; border: none; cursor: pointer; }
        button:hover { background: #0056b3; }
        .status { padding: 5px 10px; margin: 5px; border-radius: 3px; }
        .success { background: #d4edda; color: #155724; }
        .fail { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>å•†å“APIè°ƒè¯•é¡µé¢</h1>

    <div class="test-section">
        <h3>åŸºç¡€APIæµ‹è¯•</h3>
        <button onclick="testProductList()">æµ‹è¯•å•†å“åˆ—è¡¨API</button>
        <button onclick="testDebugProducts()">æµ‹è¯•è°ƒè¯•å•†å“API</button>
        <button onclick="testStats()">æµ‹è¯•ç»Ÿè®¡API</button>
        <div id="apiResult" class="result">ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•...</div>
    </div>

    <div class="test-section">
        <h3>æ•°æ®åº“è¿æ¥æµ‹è¯•</h3>
        <button onclick="testProductService()">æµ‹è¯•å•†å“æœåŠ¡</button>
        <div id="dbResult" class="result">ç­‰å¾…æµ‹è¯•...</div>
    </div>

    <div class="test-section">
        <h3>å®æ—¶çŠ¶æ€</h3>
        <div id="status">å‡†å¤‡å°±ç»ª</div>
    </div>

    <script>
        async function updateStatus(message, isSuccess = null) {
            const statusDiv = document.getElementById('status');
            const timestamp = new Date().toLocaleTimeString();
            const className = isSuccess === true ? 'success' : (isSuccess === false ? 'fail' : '');
            statusDiv.innerHTML = `<div class="status ${className}">[${timestamp}] ${message}</div>`;
        }

        async function testProductList() {
            const resultDiv = document.getElementById('apiResult');
            updateStatus('æ­£åœ¨æµ‹è¯• /product/api/list...');

            try {
                console.log('å‘é€è¯·æ±‚åˆ°: /product/api/list');
                const response = await axios.get('/product/api/list');

                console.log('æ”¶åˆ°å“åº”:', response);
                resultDiv.className = 'result';
                resultDiv.textContent = 'âœ… APIå“åº”æˆåŠŸ\n\n' + JSON.stringify(response.data, null, 2);

                if (response.data.code === 200 && response.data.data) {
                    updateStatus(`æˆåŠŸåŠ è½½ ${response.data.data.length} ä¸ªå•†å“`, true);
                    resultDiv.textContent += '\n\nğŸ“Š å•†å“æ•°é‡: ' + response.data.data.length;

                    if (response.data.data.length > 0) {
                        resultDiv.textContent += '\nğŸ“¦ ç¬¬ä¸€ä¸ªå•†å“:\n' + JSON.stringify(response.data.data[0], null, 2);
                    }
                } else {
                    updateStatus('APIè¿”å›æ•°æ®æ ¼å¼å¼‚å¸¸', false);
                }

            } catch (error) {
                console.error('APIè°ƒç”¨å¤±è´¥:', error);
                updateStatus('APIè°ƒç”¨å¤±è´¥: ' + error.message, false);

                resultDiv.className = 'error';
                let errorMsg = 'âŒ è¯·æ±‚å¤±è´¥\n\n';
                errorMsg += 'é”™è¯¯: ' + error.toString() + '\n\n';

                if (error.response) {
                    errorMsg += 'çŠ¶æ€ç : ' + error.response.status + '\n';
                    errorMsg += 'å“åº”æ•°æ®: ' + JSON.stringify(error.response.data, null, 2) + '\n';
                    errorMsg += 'å“åº”å¤´: ' + JSON.stringify(error.response.headers, null, 2) + '\n';
                } else if (error.request) {
                    errorMsg += 'è¯·æ±‚å·²å‘é€ä½†æ— å“åº”\n';
                    errorMsg += 'è¯·æ±‚URL: ' + error.config.url + '\n';
                } else {
                    errorMsg += 'è¯·æ±‚é…ç½®é”™è¯¯\n';
                }

                resultDiv.textContent = errorMsg;
            }
        }

        async function testDebugProducts() {
            const resultDiv = document.getElementById('apiResult');
            updateStatus('æ­£åœ¨æµ‹è¯• /debug/products...');

            try {
                const response = await axios.get('/debug/products');
                console.log('è°ƒè¯•APIå“åº”:', response);

                resultDiv.className = 'result';
                resultDiv.textContent = 'âœ… è°ƒè¯•APIå“åº”æˆåŠŸ\n\n' + JSON.stringify(response.data, null, 2);

                if (response.data.code === 200) {
                    updateStatus(`è°ƒè¯•APIè¿”å› ${response.data.data.length} ä¸ªå•†å“`, true);
                } else {
                    updateStatus('è°ƒè¯•APIè¿”å›é”™è¯¯: ' + response.data.message, false);
                }

            } catch (error) {
                console.error('è°ƒè¯•APIè°ƒç”¨å¤±è´¥:', error);
                updateStatus('è°ƒè¯•APIè°ƒç”¨å¤±è´¥: ' + error.message, false);

                resultDiv.className = 'error';
                resultDiv.textContent = 'âŒ è°ƒè¯•APIå¤±è´¥\n\n' + error.toString();
            }
        }

        async function testStats() {
            updateStatus('æ­£åœ¨æµ‹è¯• /debug/stats...');

            try {
                const response = await axios.get('/debug/stats');
                console.log('ç»Ÿè®¡APIå“åº”:', response);

                updateStatus('ç»Ÿè®¡APIè°ƒç”¨æˆåŠŸ', true);
                document.getElementById('apiResult').textContent = 'âœ… ç»Ÿè®¡æ•°æ®:\n\n' + JSON.stringify(response.data, null, 2);

            } catch (error) {
                console.error('ç»Ÿè®¡APIè°ƒç”¨å¤±è´¥:', error);
                updateStatus('ç»Ÿè®¡APIè°ƒç”¨å¤±è´¥: ' + error.message, false);

                document.getElementById('apiResult').className = 'error';
                document.getElementById('apiResult').textContent = 'âŒ ç»Ÿè®¡APIå¤±è´¥\n\n' + error.toString();
            }
        }

        async function testProductService() {
            const dbResult = document.getElementById('dbResult');
            updateStatus('æ­£åœ¨æµ‹è¯•å•†å“æœåŠ¡å±‚...');

            try {
                const response = await axios.get('/debug/product-test');
                console.log('å•†å“æœåŠ¡æµ‹è¯•å“åº”:', response);

                if (response.data.code === 200) {
                    updateStatus('å•†å“æœåŠ¡æµ‹è¯•æˆåŠŸ', true);
                    dbResult.className = 'result';
                    dbResult.textContent = 'âœ… å•†å“æœåŠ¡æµ‹è¯•æˆåŠŸ\n\n' +
                        'å•†å“æ•°é‡: ' + response.data.productCount + '\n\n' +
                        'æœåŠ¡è¯¦æƒ…:\n' + JSON.stringify(response.data, null, 2);
                } else {
                    updateStatus('å•†å“æœåŠ¡æµ‹è¯•å¤±è´¥: ' + response.data.message, false);
                    dbResult.className = 'error';
                    dbResult.textContent = 'âŒ å•†å“æœåŠ¡æµ‹è¯•å¤±è´¥\n\n' +
                        JSON.stringify(response.data, null, 2);
                }

            } catch (error) {
                console.error('å•†å“æœåŠ¡æµ‹è¯•å¤±è´¥:', error);
                updateStatus('å•†å“æœåŠ¡æµ‹è¯•å¤±è´¥: ' + error.message, false);

                dbResult.className = 'error';
                let errorMsg = 'âŒ æœåŠ¡æµ‹è¯•å¤±è´¥\n\n';
                errorMsg += error.toString() + '\n\n';

                if (error.response && error.response.data) {
                    errorMsg += 'è¯¦ç»†é”™è¯¯:\n' + JSON.stringify(error.response.data, null, 2);
                }

                dbResult.textContent = errorMsg;
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•
        document.addEventListener('DOMContentLoaded', function() {
            updateStatus('é¡µé¢åŠ è½½å®Œæˆï¼Œå‡†å¤‡å¼€å§‹æµ‹è¯•');
            setTimeout(testProductList, 1000);
        });
    </script>
</body>
</html>