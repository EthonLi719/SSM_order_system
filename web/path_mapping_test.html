<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>è·¯å¾„æ˜ å°„æµ‹è¯•</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; background: #f9f9f9; }
        .result { background: #fff; padding: 10px; margin: 10px 0; border: 1px solid #ccc; white-space: pre-wrap; font-family: monospace; max-height: 400px; overflow-y: auto; }
        .success { background: #e6ffe6; border-color: #99cc99; }
        .error { background: #ffe6e6; border-color: #ff9999; }
        button { padding: 10px 15px; margin: 5px; background: #007bff; color: white; border: none; cursor: pointer; }
        button:hover { background: #0056b3; }
        .section-title { color: #333; border-bottom: 2px solid #007bff; padding-bottom: 5px; margin-bottom: 15px; }
    </style>
</head>
<body>
    <h1>Productå’ŒOrderControllerè·¯å¾„æ˜ å°„æµ‹è¯•</h1>

    <div class="test-section">
        <h2 class="section-title">ProductController è·¯å¾„æµ‹è¯•</h2>
        <button onclick="testProductApiList()">æµ‹è¯• /product/api/list</button>
        <button onclick="testProductList()">æµ‹è¯• /product/list</button>
        <div id="productResults" class="result">ç‚¹å‡»æŒ‰é’®æµ‹è¯•Productè·¯å¾„...</div>
    </div>

    <div class="test-section">
        <h2 class="section-title">OrderController è·¯å¾„æµ‹è¯•</h2>
        <button onclick="testOrderApiList()">æµ‹è¯• /order/api/list</button>
        <button onclick="testOrderList()">æµ‹è¯• /order/list</button>
        <div id="orderResults" class="result">ç‚¹å‡»æŒ‰é’®æµ‹è¯•Orderè·¯å¾„...</div>
    </div>

    <div class="test-section">
        <h2 class="section-title">å¯¹æ¯”æµ‹è¯•</h2>
        <button onclick="testAllPaths()">åŒæ—¶æµ‹è¯•æ‰€æœ‰è·¯å¾„</button>
        <div id="comparisonResults" class="result">ç‚¹å‡»æŒ‰é’®è¿›è¡Œå¯¹æ¯”æµ‹è¯•...</div>
    </div>

    <div class="test-section">
        <h2 class="section-title">æµ‹è¯•ç»“æœåˆ†æ</h2>
        <div id="analysis">
            <p>æµ‹è¯•å®Œæˆåè¿™é‡Œä¼šæ˜¾ç¤ºåˆ†æç»“æœ</p>
        </div>
    </div>

    <script>
        let testResults = {
            product: {},
            order: {}
        };

        async function testProductApiList() {
            const resultDiv = document.getElementById('productResults');
            resultDiv.textContent = 'æ­£åœ¨æµ‹è¯• /product/api/list...';

            try {
                const response = await axios.get('/product/api/list');
                testResults.product.apiList = {
                    success: true,
                    status: response.status,
                    data: response.data,
                    count: response.data.count || 0
                };
                resultDiv.className = 'result success';
                resultDiv.textContent = 'âœ… /product/api/list æˆåŠŸ\n\n' + JSON.stringify(response.data, null, 2);
            } catch (error) {
                testResults.product.apiList = {
                    success: false,
                    error: error.message,
                    status: error.response?.status || 'N/A'
                };
                resultDiv.className = 'result error';
                resultDiv.textContent = 'âŒ /product/api/list å¤±è´¥\n\n' + error.message;
            }
            updateAnalysis();
        }

        async function testProductList() {
            const resultDiv = document.getElementById('productResults');
            resultDiv.textContent = 'æ­£åœ¨æµ‹è¯• /product/list...';

            try {
                const response = await axios.get('/product/list');
                testResults.product.list = {
                    success: true,
                    status: response.status,
                    contentType: response.headers['content-type']
                };
                resultDiv.className = 'result success';
                resultDiv.textContent = 'âœ… /product/list æˆåŠŸ\n\nçŠ¶æ€: ' + response.status + '\nå†…å®¹ç±»å‹: ' + response.headers['content-type'];
            } catch (error) {
                testResults.product.list = {
                    success: false,
                    error: error.message,
                    status: error.response?.status || 'N/A'
                };
                resultDiv.className = 'result error';
                resultDiv.textContent = 'âŒ /product/list å¤±è´¥\n\n' + error.message;
            }
            updateAnalysis();
        }

        async function testOrderApiList() {
            const resultDiv = document.getElementById('orderResults');
            resultDiv.textContent = 'æ­£åœ¨æµ‹è¯• /order/api/list...';

            try {
                const response = await axios.get('/order/api/list');
                testResults.order.apiList = {
                    success: true,
                    status: response.status,
                    data: response.data,
                    count: response.data.count || 0
                };
                resultDiv.className = 'result success';
                resultDiv.textContent = 'âœ… /order/api/list æˆåŠŸ\n\n' + JSON.stringify(response.data, null, 2);
            } catch (error) {
                testResults.order.apiList = {
                    success: false,
                    error: error.message,
                    status: error.response?.status || 'N/A'
                };
                resultDiv.className = 'result error';
                resultDiv.textContent = 'âŒ /order/api/list å¤±è´¥\n\n' + error.message;
            }
            updateAnalysis();
        }

        async function testOrderList() {
            const resultDiv = document.getElementById('orderResults');
            resultDiv.textContent = 'æ­£åœ¨æµ‹è¯• /order/list...';

            try {
                const response = await axios.get('/order/list');
                testResults.order.list = {
                    success: true,
                    status: response.status,
                    data: response.data,
                    count: response.data.count || 0
                };
                resultDiv.className = 'result success';
                resultDiv.textContent = 'âœ… /order/list æˆåŠŸ\n\n' + JSON.stringify(response.data, null, 2);
            } catch (error) {
                testResults.order.list = {
                    success: false,
                    error: error.message,
                    status: error.response?.status || 'N/A'
                };
                resultDiv.className = 'result error';
                resultDiv.textContent = 'âŒ /order/list å¤±è´¥\n\n' + error.message;
            }
            updateAnalysis();
        }

        async function testAllPaths() {
            const resultDiv = document.getElementById('comparisonResults');
            resultDiv.textContent = 'æ­£åœ¨æµ‹è¯•æ‰€æœ‰è·¯å¾„...';

            const tests = [
                { name: 'Product /api/list', url: '/product/api/list', controller: 'product', method: 'apiList' },
                { name: 'Product /list', url: '/product/list', controller: 'product', method: 'list' },
                { name: 'Order /api/list', url: '/order/api/list', controller: 'order', method: 'apiList' },
                { name: 'Order /list', url: '/order/list', controller: 'order', method: 'list' }
            ];

            const results = [];

            for (const test of tests) {
                try {
                    const response = await axios.get(test.url);
                    results.push({
                        ...test,
                        success: true,
                        status: response.status,
                        count: response.data.count || 0
                    });
                } catch (error) {
                    results.push({
                        ...test,
                        success: false,
                        error: error.message,
                        status: error.response?.status || 'N/A'
                    });
                }
            }

            resultDiv.className = 'result';
            let output = '=== è·¯å¾„æ˜ å°„å¯¹æ¯”æµ‹è¯•ç»“æœ ===\n\n';

            results.forEach(result => {
                const status = result.success ? 'âœ…' : 'âŒ';
                output += `${status} ${result.name}\n`;
                output += `  çŠ¶æ€ç : ${result.status}\n`;
                if (result.success) {
                    output += `  è¿”å›æ•°æ®é‡: ${result.count}\n`;
                } else {
                    output += `  é”™è¯¯: ${result.error}\n`;
                }
                output += '\n';
            });

            // åˆ†æä¸€è‡´æ€§
            const productConsistent = (results.find(r => r.controller === 'product' && r.method === 'apiList')?.success ===
                                       results.find(r => r.controller === 'product' && r.method === 'list')?.success);
            const orderConsistent = (results.find(r => r.controller === 'order' && r.method === 'apiList')?.success ===
                                     results.find(r => r.controller === 'order' && r.method === 'list')?.success);

            output += '=== ä¸€è‡´æ€§åˆ†æ ===\n\n';
            output += `ProductController è·¯å¾„ä¸€è‡´æ€§: ${productConsistent ? 'âœ… ä¸€è‡´' : 'âŒ ä¸ä¸€è‡´'}\n`;
            output += `OrderController è·¯å¾„ä¸€è‡´æ€§: ${orderConsistent ? 'âœ… ä¸€è‡´' : 'âŒ ä¸ä¸€è‡´'}\n\n`;

            if (productConsistent && orderConsistent) {
                output += 'âœ… æ‰€æœ‰Controllerçš„è·¯å¾„æ˜ å°„éƒ½å·¥ä½œæ­£å¸¸ï¼\n';
            } else {
                output += 'âš ï¸  éƒ¨åˆ†è·¯å¾„æ˜ å°„å­˜åœ¨é—®é¢˜ï¼Œéœ€è¦æ£€æŸ¥é…ç½®\n';
            }

            resultDiv.textContent = output;
        }

        function updateAnalysis() {
            const analysisDiv = document.getElementById('analysis');

            const productApiOk = testResults.product.apiList?.success || false;
            const productListOk = testResults.product.list?.success || false;
            const orderApiOk = testResults.order.apiList?.success || false;
            const orderListOk = testResults.order.list?.success || false;

            let analysis = '<h3>è·¯å¾„æ˜ å°„åˆ†æ:</h3>\n';

            analysis += '<h4>ProductController:</h4>\n';
            analysis += `<p>- /api/list: ${productApiOk ? 'âœ… æ­£å¸¸' : 'âŒ å¤±è´¥'}</p>\n`;
            analysis += `<p>- /list: ${productListOk ? 'âœ… æ­£å¸¸' : 'âŒ å¤±è´¥'}</p>\n`;
            analysis += `<p>- è·¯å¾„ä¸€è‡´æ€§: ${productApiOk === productListOk ? 'âœ… ä¸€è‡´' : 'âŒ ä¸ä¸€è‡´'}</p>\n`;

            analysis += '<h4>OrderController:</h4>\n';
            analysis += `<p>- /api/list: ${orderApiOk ? 'âœ… æ­£å¸¸' : 'âŒ å¤±è´¥'}</p>\n`;
            analysis += `<p>- /list: ${orderListOk ? 'âœ… æ­£å¸¸' : 'âŒ å¤±è´¥'}</p>\n`;
            analysis += `<p>- è·¯å¾„ä¸€è‡´æ€§: ${orderApiOk === orderListOk ? 'âœ… ä¸€è‡´' : 'âŒ ä¸ä¸€è‡´'}</p>\n`;

            analysis += '<h4>æ€»ç»“:</h4>\n';
            if ((productApiOk === productListOk) && (orderApiOk === orderListOk)) {
                analysis += '<p style="color: green;">âœ… è·¯å¾„æ˜ å°„ä¿®æ”¹æˆåŠŸï¼æ‰€æœ‰è·¯å¾„éƒ½èƒ½æ­£å¸¸è®¿é—®ã€‚</p>\n';
            } else {
                analysis += '<p style="color: red;">âŒ è·¯å¾„æ˜ å°„å­˜åœ¨é—®é¢˜ï¼Œéœ€è¦è¿›ä¸€æ­¥æ£€æŸ¥ã€‚</p>\n';
            }

            if (productApiOk) {
                analysis += `<p style="color: blue;">ğŸ“Š Product APIè¿”å› ${testResults.product.apiList.count} ä¸ªå•†å“</p>\n`;
            }
            if (orderApiOk) {
                analysis += `<p style="color: blue;">ğŸ“Š Order APIè¿”å› ${testResults.order.apiList.count} ä¸ªè®¢å•</p>\n`;
            }

            analysisDiv.innerHTML = analysis;
        }

        // é¡µé¢åŠ è½½å®Œæˆ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('è·¯å¾„æ˜ å°„æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
        });
    </script>
</body>
</html>